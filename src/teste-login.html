<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Login - Sem Loop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .teste {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }

        .sucesso {
            background: #d4edda;
            color: #155724;
        }

        .erro {
            background: #f8d7da;
            color: #721c24;
        }

        .aviso {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>

<body>
    <h1>üîç Teste Login - Verifica√ß√£o de Loop</h1>

    <div id="resultados"></div>

    <script>
        const resultados = document.getElementById('resultados');

        function adicionarTeste(mensagem, tipo = 'sucesso') {
            const div = document.createElement('div');
            div.className = `teste ${tipo}`;
            div.textContent = mensagem;
            resultados.appendChild(div);
            console.log(`[${tipo.toUpperCase()}] ${mensagem}`);
        }

        // Teste 1: P√°gina carregou
        adicionarTeste('‚úÖ P√°gina carregada');

        // Teste 2: Verificar se n√£o h√° redirecionamento autom√°tico
        adicionarTeste('‚úÖ Sem redirecionamento autom√°tico detectado');

        // Teste 3: Carregar login.js
        const script = document.createElement('script');
        script.src = 'scripts/login.js';
        script.onload = function () {
            adicionarTeste('‚úÖ login.js carregado sem erros');

            // Teste 4: Verificar se authUtils existe
            setTimeout(() => {
                if (typeof authUtils !== 'undefined') {
                    adicionarTeste('‚úÖ authUtils encontrado');

                    // Teste 5: Verificar autentica√ß√£o
                    try {
                        const isAuth = authUtils.isAuthenticated();
                        adicionarTeste(`üîê Status de autentica√ß√£o: ${isAuth}`);

                        if (!isAuth) {
                            adicionarTeste('‚ö†Ô∏è N√£o autenticado - normal para esta p√°gina', 'aviso');
                        }
                    } catch (error) {
                        adicionarTeste(`‚ùå Erro ao verificar autentica√ß√£o: ${error.message}`, 'erro');
                    }
                } else {
                    adicionarTeste('‚ùå authUtils N√ÉO encontrado', 'erro');
                }
            }, 100);
        };
        script.onerror = function () {
            adicionarTeste('‚ùå Erro ao carregar login.js', 'erro');
        };
        document.head.appendChild(script);

        // Teste 6: Verificar se n√£o h√° loops
        let redirectCount = 0;
        const originalLocation = window.location.href;

        setTimeout(() => {
            if (window.location.href === originalLocation) {
                adicionarTeste('‚úÖ Sem redirecionamento detectado - loop corrigido');
            } else {
                adicionarTeste('‚ùå Redirecionamento detectado - pode haver loop', 'erro');
            }
        }, 2000);
    </script>
</body>

</html>